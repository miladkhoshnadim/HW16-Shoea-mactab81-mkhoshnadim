<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mine peractice</title>
    <link rel="stylesheet" href="hw16-MP.css" />
    <!-- CSS only botstrap -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT"
      crossorigin="anonymous"
    />
  </head>
  <body>
    <main class="main">
      <section class="pages positionFix">
        <div class="headP9">
          <img src="/accets/logo.png" class="imageLogoP9" />
          <span class="subjectP9">My Cart</span>
          <img src="/accets/search.png" class="imageSearchP9" />
        </div>
        <section id="MainMyCartP9" class="MainMyCart">
          <!-- <div class="anOrder">
            <img class="ImageProductP9" src="/accets/nike5.jpg" alt="" />
            <div class="discriptionOrder">
              <div>
                <span class="discriptionCharacter">best shose</span>
                <img src="/accets/trashicon.png" class="imageTrash" />
              </div>
              <div class="divSizeColor">
                <span class="colorSignP9"></span>
                <span> black </span>
                <span>| size = 42</span>
              </div>
              <div class="DivPriceQuntityP9">
                <span class="PriceP9">$98.00 </span>
                <span class="divQuantityP9">
                  <span id="minesCunter" class="minesPlasP9"> - </span>
                  <span id="cunter" class="minesPlasP9"> 0 </span>
                  <span id="pluseCunter" class="minesPlasP9"> + </span>
                </span>
              </div>
            </div>
          </div> -->
        </section>
        <div class="CheckOutDiv">
          <div id="TotalpriceP8" class="felex">
            <span class="TotalpriceP8">Total Price</span>
            <span class="priceSpanP8" id="TOTALPRICE">$98.00</span>
          </div>
          <button onclick="handelCheckOut()" class="AddToCartP8">
            CheckOut ==>
          </button>
        </div>
        <div class="displayfelex">
          <div class="homeImage">
            <a href="http://127.0.0.1:5500/hw16-p5-home.html">
              <img
                class="imagehomeIcons area"
                src="/accets/homelighticon.jpg"
                alt=""
            /></a>
            <span class="Labelhome">Home</span>
          </div>
          <div class="homeImage">
            <img class="imagehomeIcons area" src="/accets/bagicon.png" alt="" />
            <span class="Labelhome">Cart</span>
          </div>
          <div class="homeImage">
            <a href="http://127.0.0.1:5500/hw16-p14-myorder.html">
              <img class="imagehomeIcons" src="/accets/cart2.png" alt=""
            /></a>
            <span class="Labelhome">Orders</span>
          </div>
          <div class="homeImage">
            <img class="imagehomeIcons" src="/accets/wallet2.png" alt="" />
            <span class="Labelhome">Wallet</span>
          </div>
          <div class="homeImage">
            <img class="imagehomeIcons" src="/accets/person.png" alt="" />
            <span class="Labelhome">Profile</span>
          </div>
        </div>
      </section>
      <section class="pages PageDeletP9Back hiden" id="Layer2P9"></section>
      <section class="pages PageDeletP9 hiden" id="Layer3P9">
        <div class="divRemoveCartP9">
          <span class="RemoveCartP9"> Remove From Cart ? </span>
          <section class="AnRemoveOrder" id="OrderToDEletP9">
            <!-- <div class="anOrder">
              <img class="ImageProductP9" src="/accets/nike5.jpg" alt="" />
              <div class="discriptionOrder">
                <div>
                  <span class="discriptionCharacter">best shose</span>
                  <img src="/accets/trashicon.png" class="imageTrash" />
                </div>
                <div class="divSizeColor">
                  <span class="colorSignP9"></span>
                  <span> black </span>
                  <span>| size = 42</span>
                </div>
                <div class="DivPriceQuntityP9">
                  <span class="PriceP9">$98.00 </span>
                  <span class="divQuantityP9">
                    <span id="minesCunter" class="minesPlasP9"> - </span>
                    <span id="cunter" class="minesPlasP9"> 0 </span>
                    <span id="pluseCunter" class="minesPlasP9"> + </span>
                  </span>
                </div>
              </div>
            </div> -->
          </section>
          <div>
            <button class="CancelP9" id="cancelP9">Cancel</button>
            <button class="CancelP9" id="YesRemoveP9">Yes Remove</button>
          </div>
        </div>
      </section>
    </main>
    <script>
      const MainMyCartP9 = document.getElementById("MainMyCartP9");
      const Layer2P9 = document.getElementById(`Layer2P9`);
      const Layer3P9 = document.getElementById(`Layer3P9`);
      const cancelP9 = document.getElementById(`cancelP9`);
      let counter = 0;
      let id = 0;
      let TotalCount = [];
      let Prices = [];
      let TotalPrices = 0;
      MainMyCartP9.innerHTML = ``;
      fetch(`http://localhost:3000/MyCart`)
        .then((response) => response.json())
        .then((data) => {
          if (data.length > 0) {
            data.forEach((e) => {
              MainMyCartP9.innerHTML += ` <div id="${e.id}" class="anOrder">
                  <img class="ImageProductP9" src="${e.image}" alt="" />
                  <div class="discriptionOrder">
                    <div>
                      <span class="discriptionCharacter">${e.Type}</span>
                      <img src="/accets/trashicon.png" id="Trash${e.id}" onclick="HandelEmageTrash(id)" class="imageTrash" />
                    </div>
                    <div class="divSizeColor">
                      <span class="colorSignP9" style="background-color:${e.color} ;"></span>
                      <span> ${e.color} </span>
                      <span>| size = ${e.size}</span>
                    </div>
                    <div class="DivPriceQuntityP9">
                      <span class="PriceP9">${e.price} </span>
                      <span class="divQuantityP9">
                        <span id="minesCunter${e.id}" onclick="HandelMines(id)"  class="minesPlasP9 MINES"> - </span>
                        <span id="cunter${e.id}" class="minesPlasP9 COUNTER"> ${e.conter} </span>
                        <span id="pluseCunter${e.id}" onclick="HandelPlus(id)" class="minesPlasP9 PLUS"> + </span>
                      </span>
                    </div>
                  </div>
                </div>`;
            });
          } else {
            MainMyCartP9.innerHTML = `<div class="EmptyOrderP9">
                        <div  class="divImageEmptyOrder">
                          <img src="/accets/EmptyOrder.png" alt="">
                        </div>
                        <div class="headEmptyMassageP9">You don't have an order yet!</div>
                        <div class="divImageEmptyOrder">You don't have an active order at this time.</div>
                      </div>`;
          }
        })
        .then(() => {
          totalPrice();
        });

      cancelP9.addEventListener("click", function () {
        Layer3P9.classList.add("comeDowen");
        setTimeout(() => {
          Layer2P9.classList.add("hiden");
          Layer3P9.classList.add("hiden");
          Layer3P9.classList.remove("comeUp");
          Layer3P9.classList.remove("comeDowen");
        }, "1800");
      });

      const modal = document.querySelector(".PageDeletP9Back");

      window.onclick = function (e) {
        if (e.target == modal) {
          cancelP9.click();
        }
      };

      function HandelMines(d) {
        console.log("!@#", d.substring(11));
        id = d.substring(11);
        counter = document.getElementById(`cunter${id}`).innerHTML;
        if (counter > 1) {
          --counter;
          document.getElementById(`cunter${id}`).innerHTML = `${counter}`;
          totalPrice();
          PostCounter(id, counter);
        } else if (counter == 1) {
          HandelEmageTrash(d.substring(6));
        }
      }

      function HandelPlus(d) {
        console.log("!@#", d.substring(11));
        id = d.substring(11);
        counter = document.getElementById(`cunter${id}`).innerHTML;
        ++counter;
        document.getElementById(`cunter${id}`).innerHTML = `${counter}`;
        totalPrice();
        PostCounter(id, counter);
      }

      function PostCounter(d, co) {
        fetch(`http://localhost:3000/MyCart/${d}`)
          .then((response) => response.json())
          .then((oo) => {
            fetch(`http://localhost:3000/MyCart/${d}`, {
              method: "PUT",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                image: `${oo.image}`,
                size: `${oo.size}`,
                color: `${oo.color}`,
                price: `${oo.price}`,
                Type: `${oo.Type}`,
                conter: `${co}`,
              }),
            });
          });

        // console.log("!@#", "http://localhost:3000/MyCart/" +d, co);
        // fetch("http://localhost:3000/MyCart/" + d, {
        //   method: "PUT",
        //   body: JSON.stringify({ conter: `${co}` }),
        //   headers: { "Content-Type": "Application/json" },
        // });
        // fetch("http://localhost:3000/MyCart/" + d, {
        //   method: "PUT",
        //   headers: {
        //     "Content-Type": "application/json",
        //   },
        //   body: JSON.stringify({
        //     conter: `${co}`,
        //   }),
        // });
      }

      function HandelEmageTrash(d) {
        console.log("!@#", d.substring(5));
        id = d.substring(5);
        const element = document.getElementById(`${id}`);
        console.log("element", element);

        document.getElementById(
          `OrderToDEletP9`
        ).innerHTML = `<div class="anOrder">${element.innerHTML}<\div>`;

        Layer2P9.classList.remove("hiden");
        Layer3P9.classList.remove("hiden");
        Layer3P9.classList.add("comeUp");
        document
          .getElementById(`YesRemoveP9`)
          .addEventListener("click", function () {
            handelRemove(id);
          });
      }

      function totalPrice() {
        TotalCount = [];
        Prices = [];
        TotalPrices = 0;
        [...document.querySelectorAll(".COUNTER")].forEach((tagCOUNTER) => {
          TotalCount.push(tagCOUNTER.innerHTML);
        });
        [...document.querySelectorAll(".PriceP9")].forEach((tagPrice) => {
          Prices.push(tagPrice.innerHTML);
        });
        Prices.forEach((tot, i) => {
          TotalPrices += tot.substring(1) * TotalCount[i];
        });
        document.getElementById(`TOTALPRICE`).innerHTML = `$${TotalPrices}.00`;
      }

      function handelRemove(index) {
        console.log("yesRemove", index, document.getElementById(`${index}`));
        cancelP9.click();
        document.getElementById(`${index}`).remove();
        fetch("http://localhost:3000/MyCart/" + index, {
          method: "DELETE",
        });
      }

      function handelToHome() {
        location.href = "http://127.0.0.1:5500/hw16-p5-home.html";
      }

      function handelCheckOut() {
        location.href = "http://127.0.0.1:5500/hw16-p10-chechOut.html";
      }
    </script>
  </body>
  <!-- <script src="hw16-MP.js"></script> -->
</html>
